<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
    crossorigin="anonymous"
  />

  <body>
    <div class="container">
      <div class="mt-5">
        <table class="table table-responsive table-bordered table-sm">
          <thead>
            <tr>
              <th class="table-active">Strategy</th>
              <th class="table-active">FRAME TIME</th>
              <th class="table-active">STOCK NAME</th>
              <th class="table-warning">Buy Time</th>
              <th class="table-warning">DATE</th>
              <th class="table-warning">QTY</th>
              <th class="table-warning">Price</th>
              <th class="table-warning">BRK</th>
              <th class="table-warning">NRATE</th>
              <th class="table-warning">AMT</th>
              <th class="table-danger">Buy Time</th>
              <th class="table-danger">DATE</th>
              <th class="table-danger">QTY</th>
              <th class="table-danger">Price</th>
              <th class="table-danger">BRK</th>
              <th class="table-danger">NRATE</th>
              <th class="table-danger">AMT</th>
              <th class="table-success">Total</th>
            </tr>
          </thead>
          <tbody id="data"></tbody>
        </table>
      </div>
    </div>
  </body>
  <script>
    window.addEventListener("DOMContentLoaded", (event) => {
      var socket = new WebSocket("ws://" + window.location.host + "/data/");
      
      if (socket.readyState == WebSocket.OPEN) {
        socket.onopen();
      }
      socket.onopen = function open() {
        console.log("WebSockets connection created.");
      };
      socket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        console.log(data);
   
        var text = "";
        for (let i = 0, len = data["data"].length; i < len; i++) {
          text += `
          <tr>
            <th class="table-active">${data["data"][i]["strategy"]["name"]}
            </th>`;
            if (data["data"][i]["buy"] !== null) {
              text += `
              <th class="table-active">${data["data"][i]["buy"]["time_frame"]}</th>
              <th class="table-active">${data["data"][i]["buy"]["stockname"]}</th>
              `
            }
            else if (data["data"][i]["sell"] !== null) {
              text += `
            <th class="table-active">${data["data"][i]["sell"]["time_frame"]}</th>
            <th class="table-active">${data["data"][i]["sell"]["stockname"]}</th>
              `
            }

          if (data["data"][i]["buy"] !== null) {
            text += `
          <th class="table-warning">${data["data"][i]["buy"]["time"].split('.')[0]}</th>
          <th class="table-warning">${data["data"][i]["buy"]["date"]}</th>
          <th class="table-warning">${Number(data["data"][i]["buy"]["quanty"]).toFixed(2)}</th>
          <th class="table-warning">${Number(data["data"][i]["buy"]["price"]).toFixed(2)}</th>
          <th class="table-warning">${Number(data["data"][i]["buy"]["brk"]).toFixed(2)}</th>
          <th class="table-warning">${Number(data["data"][i]["buy"]["nrate"]).toFixed(2)}</th>
          <th class="table-warning">${Number(data["data"][i]["buy"]["amt"]).toFixed(2)}</th>`;
          } else {
            text += `
          <th class="table-warning"></th>
          <th class="table-warning"></th>
          <th class="table-warning"></th>
          <th class="table-warning"></th>
          <th class="table-warning"></th>
          <th class="table-warning"></th>
          <th class="table-warning"></th>`;
          }
          if (data["data"][i]["sell"] !== null) {
            text += `
          <th class="table-danger">${data["data"][i]["sell"]["time"].split('.')[0]}</th>
          <th class="table-danger">${data["data"][i]["sell"]["date"]}</th>
          <th class="table-danger">${Number(data["data"][i]["sell"]["quanty"]).toFixed(2)}</th>
          <th class="table-danger">${Number(data["data"][i]["sell"]["price"]).toFixed(2)}</th>
          <th class="table-danger">${Number(data["data"][i]["sell"]["brk"]).toFixed(2)}</th>
          <th class="table-danger">${Number(data["data"][i]["sell"]["nrate"]).toFixed(2)}</th>
          <th class="table-danger">${Number(data["data"][i]["sell"]["amt"]).toFixed(2)}</th>`;
          } else {
            text += `
          <th class="table-danger"></th>
          <th class="table-danger"></th>
          <th class="table-danger"></th>
          <th class="table-danger"></th>
          <th class="table-danger"></th>
          <th class="table-danger"></th>
          <th class="table-danger"></th>`;
          }
          if (data["data"][i]["total"] !== null) {
            text += `<th class="table-success">${data["data"][i]["total"]}</th>
            </tr>`;
          } else {
            text += `<th class="table-success"></th>
            </tr>`;
          }
        }
        const elements = document.getElementById("data");
        elements.innerHTML = text;
      };
      socket.onclose = function (e) {
        console.log(e, "close event ")
      }
    });
  </script>
</html>
